# 24 bit colour
set-option -sa terminal-overrides ",xterm*:Tc"

# Enable mouse support for scrolling, pane selection, and resizing
set -g mouse on

# Set prefix key
unbind C-b
set -g prefix C-Space
bind C-space send-prefix

# Automatically enter copy mode on wheel scroll up
bind -n WheelUpPane if-shell -F -t = "#{pane_in_mode}" 'send-keys -X scroll-up' 'copy-mode -e'

bind -n M-[ previous-window
bind -n M-] next-window
bind -n 'M-{' previous-window
bind -n 'M-}' next-window
bind -n C-Tab next-window
bind -n C-S-Tab previous-window

# Session navigation
bind -n 'M-`' switch-client -n
bind -n 'M-~' switch-client -p

# Direct window selection with Option/Alt-number
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind -n M-0 select-window -t 10

# Open panes in current working directory
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Resize panes
bind -n -r 'M--' resize-pane -L 5
bind -n -r 'M-=' resize-pane -R 5
bind -n -r 'M-_' resize-pane -U 5
bind -n -r 'M-+' resize-pane -D 5

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 10000

# Use vi mode for copy mode
setw -g mode-keys vi

# Set terminal title to show hostname and last 2 path components
set -g set-titles on
set -g set-titles-string "#{host_short}: #(basename $(dirname '#{pane_current_path}'))/#{b:pane_current_path}"

# Set vi-mode for yank
set-window-option -g mode-keys vi
# Keybindings for copy mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Plugin list
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'catppuccin/tmux'

# OSC52 clipboard support for remote SSH sessions
# Tmux 3.3+ has built-in OSC52 support via the copy-pipe command
set -g set-clipboard on
set -ag terminal-features ',*:clipboard'

# Copy to clipboard using OSC52 (works over SSH without xclip/xsel)
# This sends the copied text to the local terminal using OSC52 escape sequences
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "~/.config/tmux/scripts/osc52-copy.sh"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "~/.config/tmux/scripts/osc52-copy.sh"
bind -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "~/.config/tmux/scripts/osc52-copy.sh"

# Catppuccin options
set -g @catppuccin_flavour "mocha"
set -g @catppuccin_window_status_style "none"
set -g @catppuccin_window_text " #W "
set -g @catppuccin_window_current_text " #W "
set -g @catppuccin_status_left_separator ""
set -g @catppuccin_status_middle_separator ""
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_connect_separator "yes"
set -g @catppuccin_status_background "default"
set -g @catppuccin_application_text ' #{s|^(.*/)?([^/]*/[^/]*)$|\2|:pane_current_path}'
# set -g @catppuccin_date_time_text " %H:%M "
set -g window-status-separator " "
set -g window-status-format "#[fg=#313244,bg=#181825]#[fg=#cdd6f4,bg=#313244]#I #W #[fg=#313244,bg=#181825]"
set -g window-status-current-format "#[fg=#cba6f7,bg=#181825]#[fg=#11111b,bg=#cba6f7]#I #[fg=#cdd6f4,bg=#45475a] #W #[fg=#45475a,bg=#181825]"

# Initialize TPM
run '~/.tmux/plugins/tpm/tpm'

# Catppuccin status line
set -g status-left "#[fg=#45405a,bg=default]▐#[fg=#cba6f7,bg=#1e1e2e] #S "
set -g status-left-length 100
set -g status-right-length 100
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right '#(~/.config/tmux/scripts/git-brief.sh "#{pane_current_path}")'
set -ag status-right '#(~/.config/tmux/scripts/load-brief.sh)'
set -ag status-right '#(~/.config/tmux/scripts/cpu-brief.sh)'
set -ag status-right '#(~/.config/tmux/scripts/memory-brief.sh)'
set -ag status-right '#(~/.config/tmux/scripts/disk-brief.sh "#{pane_current_path}")'
set -ag status-right '#(~/.config/tmux/scripts/host-brief.sh)'
# set -ag status-right "#{E:@catppuccin_status_date_time}"
